plugins {
    id 'airbyte-docker'
    id "base" // ?
    id "com.github.node-gradle.node" version "2.2.4"
}

node {
    download = true
    version = "14.11.0"
}

npm_run_build {
    inputs.files fileTree('public')
    inputs.files fileTree('src')
    inputs.file 'package.json'
    inputs.file 'package-lock.json'

    outputs.dir project.buildDir
}
assemble.dependsOn npm_run_build

task test(type: NpmTask) {
    dependsOn assemble

    args = ['run', 'test', '--', '--watchAll=false']
    inputs.files fileTree('src')
    inputs.file 'package.json'
    inputs.file 'package-lock.json'
}

airbyteStandardSourceTestFile {
    // For more information on standard source tests, see https://docs.airbyte.io/contributing-to-airbyte/building-new-connector/testing-connectors

    // All these input paths must live inside this connector's directory (or subdirectories)
    // TODO update the spec JSON file
    specPath = "source_javascript_template_singer/spec.json"

    // configPath points to a config file which matches the spec.json supplied above. secrets/ is gitignored by default, so place your config file
    // there (in case it contains any credentials)
    // TODO update the config file to contain actual credentials
    configPath = "secrets/config.json"
    // TODO update the sample configured_catalog JSON for use in testing
    // Note: If your source supports incremental syncing, then make sure that the catalog that is returned in the get_catalog method is configured
    // for incremental syncing (e.g. include cursor fields, etc).
    configuredCatalogPath = "sample_files/configured_catalog.json"
}


dependencies {
    implementation files(project(':airbyte-integrations:bases:base-standard-source-test-file').airbyteDocker.outputs)
    implementation files(project(':airbyte-integrations:bases:base-python').airbyteDocker.outputs)
}
